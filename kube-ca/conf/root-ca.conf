#
# Root CA OpenSSL configuration file.
#

# This definition stops the following lines choking if HOME isn't
# defined.
HOME        = .
RANDFILE    = $ENV::HOME/.rnd

[ default ]
dir                     = .
cluster                 = $ENV::cluster_name
ca                      = root-ca

####################################################################
# req
####################################################################

[ req ]
default_bits            = 2048
encrypt_key             = no
default_md              = sha256
utf8                    = yes                   # Input is UTF-8
string_mask             = utf8only              # Emit UTF-8 strings
prompt                  = no                    # Don't prompt for DN
distinguished_name      = root_ca_dn
req_extensions          = root_ca_req           # Extensions to add to the certificate request

[ root_ca_dn ]
countryName             = $ENV::CA_COUNTRY
stateOrProvinceName     = $ENV::CA_STATE
localityName            = $ENV::CA_LOCALITY
0.organizationName      = WarfordNet
commonName              = WarfordNet Root CA
emailAddress            = $ENV::CA_EMAIL

[ root_ca_req ]
basicConstraints        = critical,CA:true
keyUsage                = critical,keyCertSign,cRLSign
subjectKeyIdentifier    = hash

####################################################################
# ca
####################################################################

[ ca ]
default_ca              = root_ca                   # The default ca section

[ root_ca ]

# Files
certificate             = $dir/$cluster/$ca/certs/$ca.crt    # The CA certificate
private_key             = $dir/$cluster/$ca/keys/$ca.key     # The private key
serial                  = $dir/$cluster/$ca/db/$ca.crt.srl   # The current serial number
crlnumber               = $dir/$cluster/$ca/db/$ca.crl.srl   # the current crl number
database                = $dir/$cluster/$ca/db/$ca.db        # Database of signed certificates.

# Options
new_certs_dir           = $dir/$cluster/$ca/newcerts         # default place for new certs.
copy_extensions         = copy                      # Copy extensions in requests to certificates
unique_subject          = no                        # Set to 'no' to allow creation of
                                                    # several ctificates with same subject.
default_days            = 3652                      # how long to certify for
default_crl_days        = 30                        # how long before next CRL
default_md              = sha256                    # use public key default MD
preserve                = no                        # keep passed DN ordering
email_in_dn             = no                        # Add email to DN?  If "no" then email MUST NOT BE IN THE MATCH POLICY
policy                  = policy_match
name_opt                = ca_default                # Subject Name options
cert_opt                = ca_default                # Certificate field options
crl_extensions          = crl_ext                   # CRL extensions
x509_extensions         = ca_ext                    # The extentions to add to CA certs

# For the CA policy
[ policy_match ]
countryName             = match
stateOrProvinceName     = optional
localityName            = optional
organizationName        = optional
organizationalUnitName  = optional
commonName              = supplied

# For the 'anything' policy
# At this point in time, you must list all acceptable 'object' types.
[ policy_anything ]
countryName             = optional
stateOrProvinceName     = optional
localityName            = optional
organizationName        = optional
organizationalUnitName  = optional
commonName              = supplied

[ ca_ext ]
keyUsage=critical,digitalSignature,keyEncipherment,keyCertSign,cRLSign

# These extensions are added when 'ca' signs a request.
#
# Extensions come in two flavors: critical and non-critical. The spec
# often defines extensions as "MUST be marked critical" or "SHOULD be
# marked critical." If an extension is marked critical it means that any
# implementation that doesn't support that extension needs to not accept
# the certificate.

# basicConstraints
#   The first (mandatory) constraint is CA followed by TRUE or FALSE. 
#   If CA is TRUE then an optional pathlen name followed by an non-negative
#   value can be included.
#   The pathlen parameter indicates the maximum number of CAs that can 
#   appear below this one in a chain.
basicConstraints=critical,CA:true        # This is a master CA that will be used to create intermediate CAs

# subjectKeyIdentifier and authorityKeyIdentifier
#
# PKIX recommendations are:
#   subjectKeyIdentifier=hash
#   authorityKeyIdentifier=keyid,issuer
# which armless if included in all certificates.

# subjectKeyIdentifier
#   Can be either 'hash' or a hex string value.
subjectKeyIdentifier=hash

# authorityKeyIdetifier
#   The authority key identifier extension permits two options. keyid and 
#   issuer: both can take the optional value "always".
#
#   If the keyid option is present an attempt is made to copy the subject 
#   key identifier from the parent certificate. If the value "always" is
#   present then an error is returned if the option fails.
#
#   The issuer option copies the issuer and serial number from the issuer 
#   certificate. This will only be done if the keyid option fails or is 
#   not included unless the "always" flag will always include the value.
authorityKeyIdentifier=keyid:always

# CRL extensions exist solely to point to the CA certificate that has issued
# the CRL.
[ crl_ext ]
authorityKeyIdentifier = keyid:always
